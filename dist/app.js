import{ref as e,onBeforeUnmount as o,pushScopeId as n,popScopeId as t,openBlock as a,createBlock as r,createVNode as l,renderSlot as i,withScopeId as s,toRaw as d,defineComponent as p,toRefs as c,provide as u,onMounted as m,inject as w,onUnmounted as v,watch as g}from"vue";import{loadNow as y}from"connect-google-maps";import b from"markerwithlabel";const C=["bounds_changed","center_changed","click","dblclick","drag","dragend","dragstart","heading_changed","idle","maptypeid_changed","mousemove","mouseout","mouseover","projection_changed","resize","rightclick","tilesloaded","tilt_changed","zoom_changed"],f=["animation_changed","click","dblclick","rightclick","dragstart","dragend","drag","mouseover","mousedown","mouseup","draggable_changed","clickable_changed","cursor_changed","flat_changed","rightclick","zindex_changed","icon_changed","position_changed","shape_changed","title_changed","visible_changed"],h=["click","dblclick","drag","dragend","dragstart","mousedown","mousemove","mouseout","mouseover","mouseup","rightclick"],k=h,$=h.concat(["bounds_changed"]),A=h.concat(["center_changed","radius_changed"]),_=["closeclick","content_changed","domready","position_changed","zindex_changed"],I=e(null),x=e(null),O=()=>({map:I,api:x});var P={name:"google-map",props:{apiKey:String,backgroundColor:String,center:Object,clickableIcons:{type:Boolean,default:void 0},controlSize:Number,disableDefaultUi:{type:Boolean,default:void 0},disableDoubleClickZoom:{type:Boolean,default:void 0},draggable:{type:Boolean,default:void 0},draggableCursor:String,draggingCursor:String,fullscreenControl:{type:Boolean,default:void 0},fullscreenControlPosition:String,gestureHandling:String,heading:Number,keyboardShortcuts:{type:Boolean,default:void 0},mapTypeControl:{type:Boolean,default:void 0},mapTypeControlOptions:Object,mapTypeId:{type:[Number,String]},maxZoom:Number,minZoom:Number,noClear:{type:Boolean,default:void 0},panControl:{type:Boolean,default:void 0},panControlPosition:String,restriction:Object,rotateControl:{type:Boolean,default:void 0},rotateControlPosition:String,scaleControl:{type:Boolean,default:void 0},scaleControlStyle:Number,scrollwheel:{type:Boolean,default:void 0},streetView:Object,streetViewControl:{type:Boolean,default:void 0},streetViewControlPosition:String,styles:Array,tilt:Number,zoom:Number,zoomControl:{type:Boolean,default:void 0},zoomControlPosition:String},setup(n,{emit:t}){const a=e(null),r=e(!1);let{map:l,api:i}=O();const s=()=>{const e={backgroundColor:n.backgroundColor,center:n.center,clickableIcons:n.clickableIcons,controlSize:n.controlSize,disableDefaultUI:n.disableDefaultUi,disableDoubleClickZoom:n.disableDoubleClickZoom,draggable:n.draggable,draggableCursor:n.draggableCursor,draggingCursor:n.draggingCursor,fullscreenControl:n.fullscreenControl,fullscreenControlOptions:n.fullscreenControlPosition?{position:i.value?.ControlPosition[n.fullscreenControlPosition]}:{},gestureHandling:n.gestureHandling,heading:n.heading,keyboardShortcuts:n.keyboardShortcuts,mapTypeControl:n.mapTypeControl,mapTypeControlOptions:n.mapTypeControlOptions,mapTypeId:n.mapTypeId,maxZoom:n.maxZoom,minZoom:n.minZoom,noClear:n.noClear,panControl:n.panControl,panControlOptions:n.panControlPosition?{position:i.value?.ControlPosition[n.panControlPosition]}:{},restriction:n.restriction,rotateControl:n.rotateControl,rotateControlOptions:n.rotateControlPosition?{position:i.value?.ControlPosition[n.rotateControlPosition]}:{},scaleControl:n.scaleControl,scaleControlOptions:n.scaleControlStyle?{style:n.scaleControlStyle}:{},scrollwheel:n.scrollwheel,streetView:n.streetView,streetViewControl:n.streetViewControl,streetViewControlOptions:n.streetViewControlPosition?{position:i.value?.ControlPosition[n.streetViewControlPosition]}:{},styles:n.styles,tilt:n.tilt,zoom:n.zoom,zoomControl:n.zoomControl,zoomControlOptions:n.zoomControlPosition?{position:window.$mapApi?.ControlPosition[n.zoomControlPosition]}:{}};return Object.keys(e).forEach((o=>void 0===e[o]&&delete e[o])),e};o((()=>{l.value&&window.$mapApi?.event.clearInstanceListeners(window.$mapInstance)}));return"undefined"!=typeof window&&y("places",n.apiKey).then((({maps:e})=>{if(window.$mapInstance&&window.$mapDom){document.querySelector("#google-map").appendChild(window.$mapDom),window.$mapInstance.setOptions(s()),t("map-ready",{map:window.$mapInstance,api:window.$mapApi}),console.log("复用地图实例")}else{const{Map:o}=window.$mapApi={...e};window.$mapInstance=new o(document.querySelector("#google-map"),s());const n=document.querySelector("#google-map").childNodes[0];n.style.overflow="hidden",window.$mapDom=n,window.$markerArray={},console.log("地图初始化成功"),l.value=window.$mapInstance,i.value=window.$mapApi,C.forEach((e=>{window.$mapInstance?.addListener(e,(()=>t(e)))})),r.value=!0,t("map-ready",{map:window.$mapInstance,api:window.$mapApi})}})),{mapRef:a,ready:r,map:l,api:i,resetMap:(e=!0)=>{window.$mapInstance&&(Object.keys(window.$markerArray).forEach((e=>{for(const o of window.$markerArray[e])try{window.$mapApi.event.clearInstanceListeners(o),o.setMap(null)}catch(e){console.warn(e)}delete window.$markerArray[e]})),e&&Object.keys(window.$mapApi.ControlPosition).forEach((e=>{window.$mapInstance.controls[window.$mapApi.ControlPosition[e]].clear()})))}}}};const S=s("data-v-0247bc61");n("data-v-0247bc61");const N={ref:"mapRef",id:"google-map"};t();const j=S(((e,o,n,t,s,d)=>(a(),r("div",N,[l("div",null,[i(e.$slots,"default")])],512))));function M(e,o){void 0===o&&(o={});var n=o.insertAt;if(e&&"undefined"!=typeof document){var t=document.head||document.getElementsByTagName("head")[0],a=document.createElement("style");a.type="text/css","top"===n&&t.firstChild?t.insertBefore(a,t.firstChild):t.appendChild(a),a.styleSheet?a.styleSheet.cssText=e:a.appendChild(document.createTextNode(e))}}M("\n#google-map[data-v-0247bc61] {\n  position: relative;\n  width: 100%;\n}\n"),P.render=j,P.__scopeId="data-v-0247bc61",P.__file="src/google-map.vue";const L=(n,t,a,r,l)=>{const i=e(null);let s=null;const{map:p,api:c}=O();return p.value&&c.value&&(i.value=s=new window.$mapApi[n]({...d(a),map:window.$mapInstance}),t.forEach((e=>{s?.addListener(e,(o=>r(e,o,s,l)))})),window.$markerArray[n]?window.$markerArray[n].push(s):window.$markerArray[n]=[s]),o((()=>{s&&(window.$mapApi?.event.clearInstanceListeners(s),s.setMap(null),window.$markerArray[n]&&window.$markerArray[n].length>0&&window.$markerArray[n].splice(l,1))})),{component:i}};var W=p({props:{options:{type:Object,required:!0},index:{type:Number,required:!0}},setup(e,{emit:o}){const{options:n,index:t}=c(e);return{marker:L("Marker",f,d(n.value),o,t)}},render:()=>null}),z={name:"slot-marker",props:{options:{default:()=>({}),type:Object},index:{default:0,type:Number}},setup(n,t){const{options:a,index:r}=c(n),l=e(null),i=e(null),s=e(null);let d=null;u("$marker",{marker:i});const p=e=>{if(window.$mapInstance&&window.$mapApi){t.slots.labelContent&&1===t.slots.labelContent.length&&t.slots.labelContent[0]&&(a.value=Object.assign({},a.value,{labelContent:s.value}));const e=Object.assign(Object.assign({},a.value),{map:window.$mapInstance}),o=s.value;o.parentNode.removeChild(o);const n=b(window.$mapApi);i.value=d=new n(e),f.forEach((e=>{d&&d.addListener(e,(o=>t.emit(e,o,i.value,r.value)))})),window.$markerArray.MarkerWithLabel?window.$markerArray.MarkerWithLabel.push(d):window.$markerArray.MarkerWithLabel=[d]}},w=()=>{d&&(window.$mapApi&&window.$mapApi.event.clearInstanceListeners(d),d.setMap(null),window.$markerArray.MarkerWithLabel&&window.$markerArray.MarkerWithLabel.length>0&&window.$markerArray.MarkerWithLabel.splice(r,1))};return m((()=>{p()})),o((()=>{w()})),{marker:i,markerRef:s,markerWithLabel:l,createMarker:p,removeMarker:w}}};const B=s("data-v-7e92e6b4");n("data-v-7e92e6b4");const q={ref:"markerRef"};t();const T=B(((e,o,n,t,s,d)=>(a(),r("div",null,[l("div",q,[i(e.$slots,"labelContent")],512),i(e.$slots,"default")]))));M("\n\n"),z.render=T,z.__scopeId="data-v-7e92e6b4",z.__file="src/components/MarkerWithLabel.vue";var E={name:"InfoWindow",props:{options:{default:()=>({}),type:Object},show:{default:!1,type:Boolean},index:{default:0,type:Number}},setup(o,n){const{options:t,show:a,index:r}=c(o),l=w("$marker"),i=e(null),s=e(null),p=e(null),u=e(null);let y=null;const b=e(null);m((()=>{C()})),v((()=>{h(),u.value&&(s.value&&s.value.event.clearInstanceListeners(y),u.value.setMap(null))})),g((()=>l.marker),((e,o,n)=>{C(),n((()=>{h()}))})),g((()=>a.value),((e,o)=>{e?f():h()}));const C=e=>{if(window.$mapInstance&&window.$mapApi&&l.marker){h(),i.value=window.$mapInstance,s.value=window.$mapApi,p.value=d(l.marker);const e=Object.assign(Object.assign({},t.value,{content:b.value,map:i.value}));u.value=y=new window.$mapApi.InfoWindow(e),_.forEach((e=>{y&&y.addListener(e,(o=>n.emit(e,o,u.value,r.value)))})),a.value&&f()}},f=()=>{u?.value?.open&&u.value.open(i.value,d(l.marker.value))},h=()=>{u.value&&u.value.close(),n.emit("close")};return{infoWindow:u,infoWindowRef:b,openInfoWindow:f,closeInfoWindow:h}}};const V=s("data-v-5b373d6e");n("data-v-5b373d6e");const D={ref:"infoWindowRef"};t();const R=V(((e,o,n,t,s,d)=>(a(),r("div",null,[l("div",D,[i(e.$slots,"default")],512)]))));M("\n\n"),E.render=R,E.__scopeId="data-v-5b373d6e",E.__file="src/components/InfoWindow.vue";var Z=p({props:{options:{type:Object,required:!0},index:{type:Number,required:!0}},setup(e,{emit:o}){const{options:n,index:t}=c(e),a=d(n.value);return{polyline:L("Polyline",h,a,o,t)}},render:()=>null}),H=p({props:{options:{type:Object,required:!0},index:{type:Number,required:!0}},setup(e,{emit:o}){const{options:n,index:t}=c(e);return{polygon:L("Polygon",k,d(n.value),o,t)}},render:()=>null}),U=p({props:{options:{type:Object,required:!0},index:{type:Number,required:!0}},setup(e,{emit:o}){const{options:n,index:t}=c(e);return{rectangle:L("Rectangle",$,d(n.value),o,t)}},render:()=>null}),K=p({props:{options:{type:Object,required:!0},index:{type:Number,required:!0}},setup(e,{emit:o}){const{options:n,index:t}=c(e);return{circle:L("Circle",A,d(n.value),o,t)}},render:()=>null}),G=p({props:{position:{type:String,required:!0},index:{type:Number,required:!0,default:0}},setup(n){const{map:t,api:a}=O(),r=e(null),l=e=>{t.value&&a.value&&(n.index&&(r.value.index=n.index),r.value&&(t.value.controls[a.value.ControlPosition[n.position]].push(r.value),"watch"===e&&r.value.parentNode&&r.value.parentNode.removeChild(r.value)))};return m((()=>{l("onMounted")})),o((()=>{(e=>{if(t.value&&a.value&&r.value){let e=0;t.value.controls[a.value.ControlPosition[n.position]]&&t.value.controls[a.value.ControlPosition[n.position]].forEach(((o,n)=>{o===r.value&&(e=n)})),t.value.controls[a.value.ControlPosition[n.position]].getAt(e)&&t.value.controls[a.value.ControlPosition[n.position]].removeAt(e)}})(n.index)})),g([t,()=>n.position,()=>n.index],((e,o,n)=>{l("watch")})),{controlRef:r}}});const F={ref:"controlRef"};G.render=function(e,o,n,t,l,s){return a(),r("div",F,[i(e.$slots,"default")],512)},G.__file="src/components/CustomControl.vue";export{K as Circle,G as CustomControl,P as GoogleMap,E as InfoWindow,W as Marker,z as MarkerWithLabel,H as Polygon,Z as Polyline,U as Rectangle};
